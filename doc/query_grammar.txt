== Грамматика языка запросов ==



Выражение ::= Выражение 'ИЛИ' Слагаемое | Слагаемое
Слагаемое ::= Слагаемое 'И' Множитель | Множитель
Множитель ::= НЕ Элемент | Элемент
Элемент ::= Тег | Поле | Директория | Пользователь | '(' Выражение ')'
Тег ::= <слово_без_пробелов>
Поле ::= Тег ОперацияНадПолем Значение
ОперацияНадПолем ::= '=' | '>' | '>=' | '<' | '<=' | '!='
Значение ::= Строка | Число
Строка ::= <Слово_без_пробелов, "Любые символы:#?!, но в кавычках", "Чтобы напечатать кавычку, \" добавить слеш">
Число ::= <целое или вещественное, например: 123, 2.45>
Директория ::= 'dir:' <путь внутри хранилища>
Пользователь ::= 'user:' <логин пользователя хранилища>


Примеры запросов:

(Книги ИЛИ Музыка) Рейтинг>=3 dir:other/new И (user:vlkv ИЛИ user:leno4ka)

select distinct * 
from items i 
left join tags_items ti on i.id=ti.item_id 
leftjoin tags t on t.name=ti.tag_name and t.user_login=ti.user_login
leftjoin fieldvals fv on i.id=fv.item_id
leftjoin fields f on f.name=fv.field_name and f.user_login=fv.user_login
leftjoin datarefs dr on i.id=dr.item_id
where
	(t.user_login=vlkv OR t.user_login=leno4ka OR f.user_login=vlkv OR f.user_login=leno4ka) AND
	f.name='Рейтинг' AND fv.value>=3 AND
	dr.url LIKE 'other/new%' AND
	t.name='Книги' OR t.name='Музыка'
	

	

	Что делать если путь внутри хранилища содержит пробелы?
	Как можно разрешить, чтобы частью тега могли быть знаки пунктуации (пусть и не все). Escape-последовательности?
	Разделитель дробной части чисел следует локализовать (точка или запятая)?
	Нужно иметь возможность локализовать логические операции языка запросов, например чтобы можно было по желанию заменить 'И' на 'AND'
	Если тег называется ИЛИ, т.е. совпадает с логической операцией, то его надо заключать в кавычки "ИЛИ"
	Если в запросе будет две и больше dir:directory1 И dir:directory2 то смысла в этом особого нет... Точно так же и для пользователей, т.к. каждый элемент принадлежит только одному пользователю.


